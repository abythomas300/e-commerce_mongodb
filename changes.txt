// creating a new database
use mongoShopDB

// creation and validation of 'users' collection
db.users.createCollection({'users'},{
    validator: {
            $jsonSchema: {
              bsonType: 'object',
              title: 'User Object Validation',
              required: [
                'name',
                'email',
                'password',
                'phone_number',
                'address'
              ],
              properties: {
                name: {
                  bsonType: 'string',
                  description: 'name must be a string and is required.'
                },
                email: {
                  bsonType: 'string',
                  description: 'email must be a string and is required.'
                },
                password: {
                  bsonType: 'string',
                  minLength: 8,
                  description: 'password is required and must be atleast 8 characters long.'
                },
                phone_number: {
                  bsonType: 'string',
                  description: 'phone number is required.'
                },
                address: {
                  bsonType: 'object',
                  properties: {
                    house_name: {
                      bsonType: 'string'
                    },
                    street: {
                      bsonType: 'string'
                    },
                    city: {
                      bsonType: 'string'
                    },
                    district: {
                      bsonType: 'string'
                    },
                    pin_code: {
                      bsonType: 'int',
                      description: 'pin code must be a number.'
                    }
                  }
                },
                dob: {
                  bsonType: 'date',
                  description: 'date of birth must be entered in standard ISO format.'
                }
              }
            }
        }
    }
)

//creation and validation for 'products' collection
db.createCollection('products', {
  validator: {
    $jsonSchema: {
      // validation rules for the entire collection
      bsonType: 'object',
      description: 'Validation for Products Collection',
      required: ['name', 'price', 'category'],
      properties: {
        //validation rules for each fields
        name: {
          bsonType: 'string',
          description: 'product name must be a string.'
        },
        price: {
          bsonType: 'double',
          description: 'price must be a decimal value.'
        },
        category:{
          bsonType: 'objectId',
          description: 'category id must be referenced from the category collection.'
        }
      }
    }
  }
})

// creation and validation for 'categories collection'
db.createCollection('categories',{
  validator: {
    $jsonSchema: {
      // validation rules for the entire collection
      bsonType: 'object',
      description: 'Validation for Category Collection',
      required: ['category_name'],
      // validation rules for each fields
      properties: {
        category_name: {
        bsonType: 'string',
        description: 'category name should be a string and is required'
      }
      }
    }
  }
})